{"ast":null,"code":"var _jsxFileName = \"/Users/liza/dev/react/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { Redirect, Switch, Route, Link, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute.js';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport Register from './Register.js';\nimport Login from './Login.js';\nimport InfoTooltip from './InfoTooltip.js';\nimport api from '../utils/api.js';\nimport * as auth from './Auth.js';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [loggedIn, setLoggenIn] = useState(false);\n  const history = useHistory();\n  const initialData = {\n    email: '',\n    password: ''\n  };\n  const [data, setData] = React.useState(initialData); //контекст пользователя\n\n  const [currentUser, setCurrentUser] = useState({});\n  const [isEditProfilePopupOpen, setIsEditProfileOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isSubmitPopupOpen, setIsSubmitPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [isInfoToolTipPopupOpen, setIsInfoToolTipPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [cards, setCards] = useState([]);\n  useEffect(() => {\n    const initialCards = api.getInitialCards();\n    initialCards.then(cardsInfo => {\n      setCards(cardsInfo);\n    }).catch(err => console.log(err));\n  }, []);\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card._id, isLiked).then(newCard => {\n      const newCards = cards.map(c => c._id === card._id ? newCard : c);\n      setCards(newCards);\n    }).catch(err => console.log(err));\n  }\n\n  function handleCardDelete(deletedCard) {\n    api.deleteCard(deletedCard._id).then(() => {\n      const newCards = cards.filter(currentCard => currentCard != deletedCard);\n      setCards(newCards);\n    }).catch(err => console.log(err));\n  }\n\n  useEffect(() => {\n    api.getProfileData().then(userDara => {\n      setCurrentUser(userDara);\n    }).catch(err => console.log(err));\n  }, []);\n\n  function handleCardClick(cardData) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(cardData);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfileOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsSubmitPopupOpen(false);\n    setIsImagePopupOpen(false);\n    setIsInfoToolTipPopupOpen(false);\n    setSelectedCard(null);\n  }\n\n  function handleUpdateUser(userInfo) {\n    api.updateProfileData(userInfo.name, userInfo.about).then(userInfo => {\n      setCurrentUser(userInfo);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleUpdateAvatar(avatarInfo) {\n    api.updateProfileAvatar(avatarInfo.avatar).then(avatarInfo => {\n      setCurrentUser(avatarInfo);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleAddPlaceSubmit(cardInfo) {\n    api.addCard(cardInfo.name, cardInfo.link).then(newCard => {\n      setCards([newCard, ...cards]);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleEditProfilePopupOpen() {\n    setIsEditProfileOpen(true);\n  }\n\n  function handleAddPlacePopupOpen() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarPopupOpen() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      auth.getContent(jwt).then(res => {\n        setLoggenIn(true);\n        setData({\n          email: res.data.email,\n          password: res.data.password\n        });\n        history.push('/');\n      }).catch(() => history.push('/sign-in'));\n    }\n  }, [history]);\n\n  function handleLogin(data) {\n    auth.login(data).then(res => {\n      localStorage.setItem('jwt', res.token);\n      setData({\n        email: data.email,\n        password: data.password\n      });\n      setLoggenIn(true);\n      setIsInfoToolTipPopupOpen(true);\n      setTimeout(() => {\n        setIsInfoToolTipPopupOpen(false);\n        history.push('/');\n      }, 2000);\n    }).catch(err => {\n      setIsInfoToolTipPopupOpen(true);\n      setData({\n        email: '',\n        password: ''\n      });\n      console.log(err);\n    });\n  }\n\n  function handleRegister(data) {\n    auth.register(data).then(() => {\n      setIsInfoToolTipPopupOpen(true);\n      setTimeout(() => {\n        setIsInfoToolTipPopupOpen(false);\n        history.push('/sign-in');\n      }, 2000);\n    }).catch(err => {\n      console.log(err);\n      setIsInfoToolTipPopupOpen(true);\n      setData({\n        email: '',\n        password: ''\n      });\n    });\n  }\n\n  const handleSignOut = () => {\n    localStorage.removeItem('jwt');\n    setLoggenIn(false);\n    history.push('/sing-in');\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page_content\",\n        children: /*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-up\",\n            children: [/*#__PURE__*/_jsxDEV(Header, {\n              children: /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/sign-in\",\n                className: \"header__button header__button_place_sign-up\",\n                children: \"\\u0412\\u043E\\u0439\\u0442\\u0438\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(Register, {\n              onRegister: handleRegister\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n              isOpen: isInfoToolTipPopupOpen,\n              loggedIn: loggedIn,\n              onClose: closeAllPopups,\n              action: \"зарегистрировались\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 209,\n              columnNumber: 11\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-in\",\n            children: [/*#__PURE__*/_jsxDEV(Header, {\n              children: /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/sign-up\",\n                className: \"header__button header__button_place_sign-up\",\n                children: \"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 13\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(Login, {\n              onLogin: handleLogin\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 11\n            }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n              isOpen: isInfoToolTipPopupOpen,\n              loggedIn: loggedIn,\n              onClose: closeAllPopups,\n              action: \"авторизировались\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 11\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n            value: currentUser,\n            children: /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n              path: \"/\",\n              component: Main,\n              loggedIn: loggedIn,\n              userData: data,\n              onEditProfilePopup: handleEditProfilePopupOpen,\n              onAddPlacePopup: handleAddPlacePopupOpen,\n              onEditAvatarPopup: handleEditAvatarPopupOpen,\n              cards: cards,\n              selectedCard: selectedCard,\n              onCardClick: handleCardClick,\n              onCardLike: handleCardLike,\n              onCardDelete: handleCardDelete,\n              isEditProfilePopupOpen: isEditProfilePopupOpen,\n              isEditAvatarPopupOpen: isEditAvatarPopupOpen,\n              isAddPlacePopupOpen: isAddPlacePopupOpen,\n              isSubmitPopupOpen: isSubmitPopupOpen,\n              isImagePopupOpen: isImagePopupOpen,\n              onClose: closeAllPopups,\n              onUpdateUser: handleUpdateUser,\n              onUpdateAvatar: handleUpdateAvatar,\n              onAddPlace: handleAddPlaceSubmit,\n              onSignOut: handleSignOut\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            children: !loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/sign-in\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 24\n            }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 53\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 3\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 196,\n    columnNumber: 1\n  }, this);\n}\n\n_s(App, \"8boBB+ss372bTZo7E3sMZ/8Y9dQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/liza/dev/react/react-mesto-auth/src/components/App.js"],"names":["React","useState","useEffect","Redirect","Switch","Route","Link","useHistory","ProtectedRoute","Header","Main","Register","Login","InfoTooltip","api","auth","CurrentUserContext","App","loggedIn","setLoggenIn","history","initialData","email","password","data","setData","currentUser","setCurrentUser","isEditProfilePopupOpen","setIsEditProfileOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isSubmitPopupOpen","setIsSubmitPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isInfoToolTipPopupOpen","setIsInfoToolTipPopupOpen","selectedCard","setSelectedCard","cards","setCards","initialCards","getInitialCards","then","cardsInfo","catch","err","console","log","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","deletedCard","deleteCard","filter","currentCard","getProfileData","userDara","handleCardClick","cardData","closeAllPopups","handleUpdateUser","userInfo","updateProfileData","name","about","handleUpdateAvatar","avatarInfo","updateProfileAvatar","avatar","handleAddPlaceSubmit","cardInfo","addCard","link","handleEditProfilePopupOpen","handleAddPlacePopupOpen","handleEditAvatarPopupOpen","jwt","localStorage","getItem","getContent","res","push","handleLogin","login","setItem","token","setTimeout","handleRegister","register","handleSignOut","removeItem"],"mappings":";;;AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAyBC,SAAzB,QAA0C,OAA1C;AACA,SAASC,QAAT,EAAmBC,MAAnB,EAA2BC,KAA3B,EAAkCC,IAAlC,EAAwCC,UAAxC,QAA0D,kBAA1D;AACA,OAAOC,cAAP,MAA2B,qBAA3B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,IAAP,MAAiB,WAAjB;AACA,OAAOC,QAAP,MAAqB,eAArB;AACA,OAAOC,KAAP,MAAkB,YAAlB;AACA,OAAOC,WAAP,MAAwB,kBAAxB;AACA,OAAOC,GAAP,MAAgB,iBAAhB;AACA,OAAO,KAAKC,IAAZ,MAAsB,WAAtB;AACA,SAASC,kBAAT,QAAmC,mCAAnC;AACA,OAAO,WAAP;;;AAIA,SAASC,GAAT,GAAe;AAAA;;AACb,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BlB,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAMmB,OAAO,GAAGb,UAAU,EAA1B;AACA,QAAMc,WAAW,GAAG;AAClBC,IAAAA,KAAK,EAAE,EADW;AAElBC,IAAAA,QAAQ,EAAE;AAFQ,GAApB;AAIA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBzB,KAAK,CAACC,QAAN,CAAeoB,WAAf,CAAxB,CAPa,CASb;;AACA,QAAM,CAACK,WAAD,EAAcC,cAAd,IAAgC1B,QAAQ,CAAC,EAAD,CAA9C;AAEA,QAAM,CAAC2B,sBAAD,EAAyBC,oBAAzB,IAAiD5B,QAAQ,CAAC,KAAD,CAA/D;AACA,QAAM,CAAC6B,mBAAD,EAAsBC,sBAAtB,IAAgD9B,QAAQ,CAAC,KAAD,CAA9D;AACA,QAAM,CAAC+B,qBAAD,EAAwBC,wBAAxB,IAAoDhC,QAAQ,CAAC,KAAD,CAAlE;AACA,QAAM,CAACiC,iBAAD,EAAoBC,oBAApB,IAA4ClC,QAAQ,CAAC,KAAD,CAA1D;AACA,QAAM,CAACmC,gBAAD,EAAmBC,mBAAnB,IAA0CpC,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAM,CAACqC,sBAAD,EAAyBC,yBAAzB,IAAsDtC,QAAQ,CAAC,KAAD,CAApE;AACA,QAAM,CAACuC,YAAD,EAAeC,eAAf,IAAkCxC,QAAQ,CAAC,IAAD,CAAhD;AAEA,QAAM,CAACyC,KAAD,EAAQC,QAAR,IAAoB1C,QAAQ,CAAC,EAAD,CAAlC;AAEEC,EAAAA,SAAS,CAAC,MAAM;AACd,UAAM0C,YAAY,GAAG9B,GAAG,CAAC+B,eAAJ,EAArB;AACAD,IAAAA,YAAY,CAACE,IAAb,CAAmBC,SAAD,IAAe;AAC/BJ,MAAAA,QAAQ,CAACI,SAAD,CAAR;AACD,KAFD,EAGCC,KAHD,CAGQC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAHhB;AAID,GANQ,EAMN,EANM,CAAT;;AASA,WAASG,cAAT,CAAwBC,IAAxB,EAA8B;AAC9B,UAAMC,OAAO,GAAGD,IAAI,CAACE,KAAL,CAAWC,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACC,GAAF,KAAUhC,WAAW,CAACgC,GAA3C,CAAhB;AAEA5C,IAAAA,GAAG,CAAC6C,oBAAJ,CAAyBN,IAAI,CAACK,GAA9B,EAAmCJ,OAAnC,EACGR,IADH,CACSc,OAAD,IAAa;AACjB,YAAMC,QAAQ,GAAGnB,KAAK,CAACoB,GAAN,CAAUC,CAAC,IAAIA,CAAC,CAACL,GAAF,KAAUL,IAAI,CAACK,GAAf,GAAqBE,OAArB,GAA+BG,CAA9C,CAAjB;AACApB,MAAAA,QAAQ,CAACkB,QAAD,CAAR;AACD,KAJH,EAKGb,KALH,CAKUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CALlB;AAMC;;AAED,WAASe,gBAAT,CAA0BC,WAA1B,EAAuC;AACrCnD,IAAAA,GAAG,CAACoD,UAAJ,CAAeD,WAAW,CAACP,GAA3B,EACGZ,IADH,CACQ,MAAM;AACV,YAAMe,QAAQ,GAAGnB,KAAK,CAACyB,MAAN,CAAaC,WAAW,IAAIA,WAAW,IAAIH,WAA3C,CAAjB;AACAtB,MAAAA,QAAQ,CAACkB,QAAD,CAAR;AACD,KAJH,EAKGb,KALH,CAKUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CALlB;AAMD;;AAEH/C,EAAAA,SAAS,CAAC,MAAM;AACdY,IAAAA,GAAG,CAACuD,cAAJ,GACGvB,IADH,CACSwB,QAAD,IAAc;AAClB3C,MAAAA,cAAc,CAAC2C,QAAD,CAAd;AACD,KAHH,EAIGtB,KAJH,CAIUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAJlB;AAKD,GANQ,EAMN,EANM,CAAT;;AAQA,WAASsB,eAAT,CAAyBC,QAAzB,EAAmC;AACjCnC,IAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACAI,IAAAA,eAAe,CAAC+B,QAAD,CAAf;AACD;;AAED,WAASC,cAAT,GAA0B;AACxB5C,IAAAA,oBAAoB,CAAC,KAAD,CAApB;AACAE,IAAAA,sBAAsB,CAAC,KAAD,CAAtB;AACAE,IAAAA,wBAAwB,CAAC,KAAD,CAAxB;AACAE,IAAAA,oBAAoB,CAAC,KAAD,CAApB;AACAE,IAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACAE,IAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACAE,IAAAA,eAAe,CAAC,IAAD,CAAf;AACD;;AAED,WAASiC,gBAAT,CAA0BC,QAA1B,EAAoC;AAClC7D,IAAAA,GAAG,CAAC8D,iBAAJ,CAAsBD,QAAQ,CAACE,IAA/B,EAAqCF,QAAQ,CAACG,KAA9C,EACGhC,IADH,CACS6B,QAAD,IAAc;AAClBhD,MAAAA,cAAc,CAACgD,QAAD,CAAd;AACAF,MAAAA,cAAc;AACf,KAJH,EAKGzB,KALH,CAKUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CALlB;AAMD;;AAED,WAAS8B,kBAAT,CAA4BC,UAA5B,EAAwC;AACtClE,IAAAA,GAAG,CAACmE,mBAAJ,CAAwBD,UAAU,CAACE,MAAnC,EACGpC,IADH,CACSkC,UAAD,IAAgB;AACpBrD,MAAAA,cAAc,CAACqD,UAAD,CAAd;AACAP,MAAAA,cAAc;AACf,KAJH,EAKGzB,KALH,CAKUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CALlB;AAMD;;AAED,WAASkC,oBAAT,CAA8BC,QAA9B,EAAwC;AACtCtE,IAAAA,GAAG,CAACuE,OAAJ,CAAYD,QAAQ,CAACP,IAArB,EAA2BO,QAAQ,CAACE,IAApC,EACGxC,IADH,CACSc,OAAD,IAAa;AACjBjB,MAAAA,QAAQ,CAAC,CAACiB,OAAD,EAAU,GAAGlB,KAAb,CAAD,CAAR;AACA+B,MAAAA,cAAc;AACf,KAJH,EAKGzB,KALH,CAKUC,GAAD,IAASC,OAAO,CAACC,GAAR,CAAYF,GAAZ,CALlB;AAMD;;AAED,WAASsC,0BAAT,GAAsC;AACpC1D,IAAAA,oBAAoB,CAAC,IAAD,CAApB;AACD;;AAED,WAAS2D,uBAAT,GAAmC;AACjCzD,IAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACD;;AAED,WAAS0D,yBAAT,GAAqC;AACnCxD,IAAAA,wBAAwB,CAAC,IAAD,CAAxB;AACD;;AAED/B,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMwF,GAAG,GAAGC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAZ;;AACA,QAAIF,GAAJ,EAAS;AACP3E,MAAAA,IAAI,CAAC8E,UAAL,CAAgBH,GAAhB,EACG5C,IADH,CACQgD,GAAG,IAAI;AACX3E,QAAAA,WAAW,CAAC,IAAD,CAAX;AACAM,QAAAA,OAAO,CAAC;AACNH,UAAAA,KAAK,EAAEwE,GAAG,CAACtE,IAAJ,CAASF,KADV;AAENC,UAAAA,QAAQ,EAAEuE,GAAG,CAACtE,IAAJ,CAASD;AAFb,SAAD,CAAP;AAIAH,QAAAA,OAAO,CAAC2E,IAAR,CAAa,GAAb;AACD,OARH,EASG/C,KATH,CASS,MAAM5B,OAAO,CAAC2E,IAAR,CAAa,UAAb,CATf;AAUD;AACF,GAdQ,EAcN,CAAC3E,OAAD,CAdM,CAAT;;AAgBA,WAAS4E,WAAT,CAAsBxE,IAAtB,EAA4B;AAC1BT,IAAAA,IAAI,CAACkF,KAAL,CAAWzE,IAAX,EACGsB,IADH,CACQgD,GAAG,IAAI;AACXH,MAAAA,YAAY,CAACO,OAAb,CAAqB,KAArB,EAA4BJ,GAAG,CAACK,KAAhC;AACA1E,MAAAA,OAAO,CAAC;AACNH,QAAAA,KAAK,EAAEE,IAAI,CAACF,KADN;AAENC,QAAAA,QAAQ,EAAEC,IAAI,CAACD;AAFT,OAAD,CAAP;AAIAJ,MAAAA,WAAW,CAAC,IAAD,CAAX;AACAoB,MAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACA6D,MAAAA,UAAU,CAAC,MAAM;AACf7D,QAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACAnB,QAAAA,OAAO,CAAC2E,IAAR,CAAa,GAAb;AACD,OAHS,EAGP,IAHO,CAAV;AAID,KAbH,EAcG/C,KAdH,CAcSC,GAAG,IAAI;AACZV,MAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACAd,MAAAA,OAAO,CAAC;AACNH,QAAAA,KAAK,EAAE,EADD;AAENC,QAAAA,QAAQ,EAAE;AAFJ,OAAD,CAAP;AAIA2B,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,KArBH;AAsBD;;AAED,WAASoD,cAAT,CAAyB7E,IAAzB,EAA+B;AAC7BT,IAAAA,IAAI,CAACuF,QAAL,CAAc9E,IAAd,EACGsB,IADH,CACQ,MAAM;AACVP,MAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACA6D,MAAAA,UAAU,CAAC,MAAM;AACf7D,QAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACAnB,QAAAA,OAAO,CAAC2E,IAAR,CAAa,UAAb;AACD,OAHS,EAGP,IAHO,CAAV;AAID,KAPH,EAQG/C,KARH,CAQSC,GAAG,IAAI;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAV,MAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACAd,MAAAA,OAAO,CAAC;AACNH,QAAAA,KAAK,EAAE,EADD;AAENC,QAAAA,QAAQ,EAAE;AAFJ,OAAD,CAAP;AAID,KAfH;AAgBD;;AAED,QAAMgF,aAAa,GAAG,MAAM;AAC1BZ,IAAAA,YAAY,CAACa,UAAb,CAAwB,KAAxB;AACArF,IAAAA,WAAW,CAAC,KAAD,CAAX;AACAC,IAAAA,OAAO,CAAC2E,IAAR,CAAa,UAAb;AACD,GAJD;;AAMA,sBACF;AAAK,IAAA,SAAS,EAAC,KAAf;AAAA,2BACE;AAAK,MAAA,SAAS,EAAC,MAAf;AAAA,6BACE;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA,+BAGE,QAAC,MAAD;AAAA,kCACE,QAAC,KAAD;AAAO,YAAA,IAAI,EAAC,UAAZ;AAAA,oCACE,QAAC,MAAD;AAAA,qCACE,QAAC,IAAD;AAAM,gBAAA,EAAE,EAAC,UAAT;AAAoB,gBAAA,SAAS,EAAC,6CAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADF,eAIE,QAAC,QAAD;AACE,cAAA,UAAU,EAAEM;AADd;AAAA;AAAA;AAAA;AAAA,oBAJF,eAOE,QAAC,WAAD;AACE,cAAA,MAAM,EAAE/D,sBADV;AAEE,cAAA,QAAQ,EAAEpB,QAFZ;AAGE,cAAA,OAAO,EAAEuD,cAHX;AAIE,cAAA,MAAM,EAAE;AAJV;AAAA;AAAA;AAAA;AAAA,oBAPF;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAeE,QAAC,KAAD;AAAO,YAAA,IAAI,EAAC,UAAZ;AAAA,oCACE,QAAC,MAAD;AAAA,qCACE,QAAC,IAAD;AAAM,gBAAA,EAAE,EAAC,UAAT;AAAoB,gBAAA,SAAS,EAAC,6CAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADF,eAIE,QAAC,KAAD;AACE,cAAA,OAAO,EAAEuB;AADX;AAAA;AAAA;AAAA;AAAA,oBAJF,eAOE,QAAC,WAAD;AACE,cAAA,MAAM,EAAE1D,sBADV;AAEE,cAAA,QAAQ,EAAEpB,QAFZ;AAGE,cAAA,OAAO,EAAEuD,cAHX;AAIE,cAAA,MAAM,EAAE;AAJV;AAAA;AAAA;AAAA;AAAA,oBAPF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAfF,eA6BE,QAAC,kBAAD,CAAoB,QAApB;AAA6B,YAAA,KAAK,EAAE/C,WAApC;AAAA,mCACA,QAAC,cAAD;AAAgB,cAAA,IAAI,EAAC,GAArB;AACQ,cAAA,SAAS,EAAEhB,IADnB;AAEQ,cAAA,QAAQ,EAAEQ,QAFlB;AAGQ,cAAA,QAAQ,EAAEM,IAHlB;AAKQ,cAAA,kBAAkB,EAAE+D,0BAL5B;AAMQ,cAAA,eAAe,EAAEC,uBANzB;AAOQ,cAAA,iBAAiB,EAAEC,yBAP3B;AAQQ,cAAA,KAAK,EAAE/C,KARf;AASQ,cAAA,YAAY,EAAEF,YATtB;AAUQ,cAAA,WAAW,EAAE+B,eAVrB;AAWQ,cAAA,UAAU,EAAEnB,cAXpB;AAYQ,cAAA,YAAY,EAAEY,gBAZtB;AAcQ,cAAA,sBAAsB,EAAEpC,sBAdhC;AAeQ,cAAA,qBAAqB,EAAEI,qBAf/B;AAgBQ,cAAA,mBAAmB,EAAEF,mBAhB7B;AAiBQ,cAAA,iBAAiB,EAAEI,iBAjB3B;AAkBQ,cAAA,gBAAgB,EAAEE,gBAlB1B;AAoBQ,cAAA,OAAO,EAAEqC,cApBjB;AAqBQ,cAAA,YAAY,EAAEC,gBArBtB;AAsBQ,cAAA,cAAc,EAAEK,kBAtBxB;AAuBQ,cAAA,UAAU,EAAEI,oBAvBpB;AAwBQ,cAAA,SAAS,EAAEoB;AAxBnB;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,kBA7BF,eA4DE,QAAC,KAAD;AAAA,sBACG,CAACrF,QAAD,gBAAY,QAAC,QAAD;AAAU,cAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBAAZ,gBAAyC,QAAC,QAAD;AAAU,cAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA;AAD5C;AAAA;AAAA;AAAA;AAAA,kBA5DF;AAAA;AAAA;AAAA;AAAA;AAAA;AAHF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADE;AA2ED;;GA9PQD,G;UAESV,U;;;KAFTU,G;AAgQT,eAAeA,GAAf","sourcesContent":["import React, {useState, useEffect } from 'react';\nimport { Redirect, Switch, Route, Link, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute.js';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport Register from './Register.js';\nimport Login from './Login.js';\nimport InfoTooltip from './InfoTooltip.js';\nimport api from '../utils/api.js';\nimport * as auth from './Auth.js';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\nimport './App.css';\n\n\n\nfunction App() {\n  const [loggedIn, setLoggenIn] = useState(false);\n  const history = useHistory();\n  const initialData = {\n    email: '',\n    password: ''\n  }\n  const [data, setData] = React.useState(initialData);\n\n  //контекст пользователя\n  const [currentUser, setCurrentUser] = useState({});\n\n  const [isEditProfilePopupOpen, setIsEditProfileOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isSubmitPopupOpen, setIsSubmitPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [isInfoToolTipPopupOpen, setIsInfoToolTipPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n\n  const [cards, setCards] = useState([]);\n\n    useEffect(() => {\n      const initialCards = api.getInitialCards();\n      initialCards.then((cardsInfo) => {\n        setCards(cardsInfo);\n      })\n      .catch((err) => console.log(err));\n    }, []);\n\n\n    function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    api.changeLikeCardStatus(card._id, isLiked)\n      .then((newCard) => {\n        const newCards = cards.map(c => c._id === card._id ? newCard : c);\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n    }\n\n    function handleCardDelete(deletedCard) {\n      api.deleteCard(deletedCard._id)\n        .then(() => {\n          const newCards = cards.filter(currentCard => currentCard != deletedCard);\n          setCards(newCards);\n        })\n        .catch((err) => console.log(err));\n    }\n\n  useEffect(() => {\n    api.getProfileData()\n      .then((userDara) => {\n        setCurrentUser(userDara);\n      })\n      .catch((err) => console.log(err))\n  }, []);\n\n  function handleCardClick(cardData) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(cardData);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfileOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsSubmitPopupOpen(false);\n    setIsImagePopupOpen(false);\n    setIsInfoToolTipPopupOpen(false);\n    setSelectedCard(null);\n  }\n\n  function handleUpdateUser(userInfo) {\n    api.updateProfileData(userInfo.name, userInfo.about)\n      .then((userInfo) => {\n        setCurrentUser(userInfo);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateAvatar(avatarInfo) {\n    api.updateProfileAvatar(avatarInfo.avatar)\n      .then((avatarInfo) => {\n        setCurrentUser(avatarInfo);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleAddPlaceSubmit(cardInfo) {\n    api.addCard(cardInfo.name, cardInfo.link)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleEditProfilePopupOpen() {\n    setIsEditProfileOpen(true);\n  }\n\n  function handleAddPlacePopupOpen() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarPopupOpen() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth.getContent(jwt)\n        .then(res => {\n          setLoggenIn(true);\n          setData({\n            email: res.data.email,\n            password: res.data.password\n          })\n          history.push('/');\n        })\n        .catch(() => history.push('/sign-in'));\n    }\n  }, [history]);\n\n  function handleLogin (data) {\n    auth.login(data)\n      .then(res => {\n        localStorage.setItem('jwt', res.token);\n        setData({\n          email: data.email,\n          password: data.password\n        });\n        setLoggenIn(true);\n        setIsInfoToolTipPopupOpen(true);\n        setTimeout(() => {\n          setIsInfoToolTipPopupOpen(false);\n          history.push('/');\n        }, 2000);\n      })\n      .catch(err => {\n        setIsInfoToolTipPopupOpen(true);\n        setData({\n          email: '',\n          password: ''\n        });\n        console.log(err)\n      });\n  }\n\n  function handleRegister (data) {\n    auth.register(data)\n      .then(() => {\n        setIsInfoToolTipPopupOpen(true);\n        setTimeout(() => {\n          setIsInfoToolTipPopupOpen(false);\n          history.push('/sign-in');\n        }, 2000);\n      })\n      .catch(err => {\n        console.log(err);\n        setIsInfoToolTipPopupOpen(true);\n        setData({\n          email: '',\n          password: ''\n        });\n      });\n  }\n\n  const handleSignOut = () => {\n    localStorage.removeItem('jwt');\n    setLoggenIn(false);\n    history.push('/sing-in');\n  }\n\n  return (\n<div className=\"App\">\n  <div className=\"page\">\n    <div className=\"page_content\">\n\n    \n      <Switch>\n        <Route path=\"/sign-up\">\n          <Header>\n            <Link to=\"/sign-in\" className=\"header__button header__button_place_sign-up\">Войти</Link>\n          </Header>\n          <Register\n            onRegister={handleRegister}\n          ></Register>\n          <InfoTooltip\n            isOpen={isInfoToolTipPopupOpen}\n            loggedIn={loggedIn}\n            onClose={closeAllPopups}\n            action={\"зарегистрировались\"}\n            ></InfoTooltip>\n        </Route>\n        <Route path=\"/sign-in\">\n          <Header>\n            <Link to=\"/sign-up\" className=\"header__button header__button_place_sign-up\">Регистрация</Link>\n          </Header>\n          <Login\n            onLogin={handleLogin}\n          ></Login>\n          <InfoTooltip\n            isOpen={isInfoToolTipPopupOpen}\n            loggedIn={loggedIn}\n            onClose={closeAllPopups}\n            action={\"авторизировались\"}\n            ></InfoTooltip>\n        </Route>\n        <CurrentUserContext.Provider value={currentUser}>\n        <ProtectedRoute path=\"/\"\n                component={Main}\n                loggedIn={loggedIn}\n                userData={data}\n\n                onEditProfilePopup={handleEditProfilePopupOpen}\n                onAddPlacePopup={handleAddPlacePopupOpen}\n                onEditAvatarPopup={handleEditAvatarPopupOpen}\n                cards={cards}\n                selectedCard={selectedCard}\n                onCardClick={handleCardClick}\n                onCardLike={handleCardLike}\n                onCardDelete={handleCardDelete}\n\n                isEditProfilePopupOpen={isEditProfilePopupOpen}\n                isEditAvatarPopupOpen={isEditAvatarPopupOpen}\n                isAddPlacePopupOpen={isAddPlacePopupOpen}\n                isSubmitPopupOpen={isSubmitPopupOpen}\n                isImagePopupOpen={isImagePopupOpen}\n\n                onClose={closeAllPopups}\n                onUpdateUser={handleUpdateUser}\n                onUpdateAvatar={handleUpdateAvatar}\n                onAddPlace={handleAddPlaceSubmit}\n                onSignOut={handleSignOut}\n                >\n        \n        </ProtectedRoute>\n        </CurrentUserContext.Provider> \n        \n        <Route>\n          {!loggedIn ? <Redirect to=\"/sign-in\" /> : <Redirect to=\"/\" />}\n        </Route>\n      </Switch>\n    \n    </div>\n        </div>\n        </div>\n  );\n}\n\nexport default App;\n\n"]},"metadata":{},"sourceType":"module"}